<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Stream</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shaka-player@4.7.11/dist/controls.css">
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #000; overflow: hidden; 
        }
        .video-container { 
            width: 100vw; height: 100vh; 
        }
        video { width: 100%; height: 100%; object-fit: contain; }
        
        /* Hide Shaka's default "Cast" button if not needed for a cleaner look */
        .shaka-cast-button { display: none !important; }
    </style>
</head>
<body>

    <div class="video-container" data-shaka-player-container>
        <video autoplay id="video" data-shaka-player-canvas></video>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.7.11/dist/shaka-player.ui.js"></script>

    <script>
        const playlistUrl = 'https://yosintv100.pages.dev/updated_playlist.json';
        
        async function init() {
            shaka.polyfill.installAll();
            const video = document.getElementById('video');
            const player = new shaka.Player(video);
            const ui = new shaka.ui.Overlay(player, video.parentElement, video);

            const urlParams = new URLSearchParams(window.location.search);
            const channelId = urlParams.get('id');

            // Silent exit if no ID provided
            if (!channelId) return;

            try {
                const response = await fetch(playlistUrl);
                const data = await response.json();
                const channelData = data[channelId];

                if (channelData) {
                    player.configure({
                        drm: { clearKeys: channelData.clearKeys }
                    });
                    await player.load(channelData.url);
                }
            } catch (e) {
                // Silently fail on errors to keep the UI clean
                console.error("Playback failed", e);
            }
        }

        document.addEventListener('shaka-ui-loaded', init);
    </script>
</body>
</html>
